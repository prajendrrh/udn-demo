# Sample FRR configuration for the bastion VM (192.168.29.10).
# Install FRR on the bastion, replace CLUSTER_NODE_IP, then load this config.
#
# Prerequisites: Bastion on same L2 as cluster nodes (e.g. 192.168.29.0/24).
#   - FRR installed (e.g. dnf install frr)
#   - Replace CLUSTER_NODE_IP with one OpenShift node IP (e.g. 192.168.29.2)
#
# This config (ASN 64512, same as cluster):
#   - Peers with OpenShift FRR-K8s at CLUSTER_NODE_IP
#   - Advertises 172.20.0.0/24 to the cluster (pods on default network can reach 172.20.0.1, etc.)
#   - Accepts routes from the cluster (e.g. 10.10.10.0/24 UDN) so bastion can reach the pod
#
# After editing, copy to /etc/frr/frr.conf or use vtysh to paste.

frr version 9
frr defaults traditional
hostname bastion
log syslog informational
service integrated-vtysh-config
!
router bgp 64512
 bgp router-id 192.168.29.10
 neighbor CLUSTER_NODE_IP remote-as 64512
 neighbor CLUSTER_NODE_IP ebgp-multihop 2
 !
 address-family ipv4 unicast
  neighbor CLUSTER_NODE_IP route-map IMPORT in
  neighbor CLUSTER_NODE_IP route-map EXPORT out
 exit-address-family
!
ip prefix-list ADVERTISE-172-20-0 seq 5 permit 172.20.0.0/24
!
route-map IMPORT permit 10
 description accept all from cluster
 exit
!
route-map EXPORT permit 10
 description advertise bastion network to cluster
 match ip address prefix-list ADVERTISE-172-20-0
 exit
!
line vty
!
