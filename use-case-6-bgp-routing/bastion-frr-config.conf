# Sample FRR configuration for the bastion VM (192.168.29.10).
# Install FRR on the bastion, then replace placeholders and load this config.
#
# Prerequisites on bastion (192.168.29.10, same network as cluster nodes):
#   - FRR installed (e.g. dnf install frr)
#   - Replace CLUSTER_NODE_IP with one OpenShift node IP from 192.168.29.0/24 (e.g. 192.168.29.2)
#
# This config:
#   - Peers with OpenShift (FRR-K8s) at CLUSTER_NODE_IP, ASN 64512
#   - Advertises 192.168.20.0/24 to the cluster (so pods can reach 192.168.20.1, etc.)
#   - Accepts routes from the cluster (route-map IMPORT in) so the bastion learns 192.168.100.0/24 (UDN)
#     and can reach the pod from the bastion (ping pod IP from the VM).
#
# After editing, copy to /etc/frr/frr.conf or use vtysh to paste.

frr version 9
frr defaults traditional
hostname bastion
log syslog informational
service integrated-vtysh-config
!
router bgp 64513
 bgp router-id 192.168.29.10
 neighbor CLUSTER_NODE_IP remote-as 64512
 neighbor CLUSTER_NODE_IP ebgp-multihop 2
 !
 address-family ipv4 unicast
  network 192.168.20.0/24
  neighbor CLUSTER_NODE_IP route-map IMPORT in
  neighbor CLUSTER_NODE_IP route-map EXPORT out
 exit-address-family
!
ip prefix-list ADVERTISE-192-168-20 seq 5 permit 192.168.20.0/24
!
route-map IMPORT permit 10
 description accept all from cluster
 exit
!
route-map EXPORT permit 10
 description advertise bastion network to cluster
 match ip address prefix-list ADVERTISE-192-168-20
 exit
!
line vty
!
